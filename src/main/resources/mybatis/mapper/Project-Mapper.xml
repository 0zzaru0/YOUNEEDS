<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="projectSQL">
 	
 	<resultMap type="creatorDto" id="creatorMap">
 		<result property="m_uid" column="m_uid"/>
 		<result property="create_name" column="create_name"/>
 		<result property="create_intro" column="create_intro"/>
 	</resultMap>

 	<resultMap type="projectDto" id="projectDtoJoin">
 		<result property="p_title" column="P_TITLE"/>
 		<result property="p_category" column="P_CATEGORTY"/>
 		<result property="target_amount" column="TARGET_AMOUNT"/>
 		<result property="p_regdate" column="P_REGDATE"/>
 		<result property="start_date" column="START_DATE"/>
 		<result property="end_date" column="END_DATE"/>
 		<result property="creator_uid" column="CREATOR_UID"/>
 		<collection property="creatorDto" resultMap="creatorMap"></collection>
 	</resultMap>	
 
 	<!-- 프로젝트 조회 -->
 	<select id="searchProjectList" parameterType="com.web.youneeds.dto.ProjectDto" 
 	 			resultType="com.web.youneeds.dto.ProjectDto">
	 	 select 
		 	 p_id, 
		 	 p_title, 
		 	 p_category, 
		 	 target_amount, 
		 	 p_regdate, 
		 	 start_date,  
		 	 end_date, 
		 	 creator_uid
		 from project
		 <if test="p_category != null and !''.equals(p_category)">
		 	where p_category = #{p_category}
		 </if>
		 order by p_id desc
 	 </select> 
 	
 	<!-- 프로젝트 등록 -->
 	<insert id="insertProject" parameterType="projectDto">
 		<selectKey keyProperty="p_id" resultType="int" order="BEFORE">
 		 	SELECT PROJECT_SEQ.NEXTVAL FROM dual
 		 </selectKey>
 	
 		INSERT INTO Project
 		(
 			p_id,
 			p_title,
 			p_category,
 			target_amount,
 			p_regdate,
 			start_date,
 			end_date,
 			creator_uid
 		 ) VALUES (
 		 	#{p_id},
 		 	#{p_title},
 		 	#{p_category},
 		 	#{target_amount},
 		 	SYSDATE,
 		 	TO_DATE(#{start_date}, 'YYYY-MM-DD HH24:MI'),
 		 	TO_DATE(#{end_date}, 'YYYY-MM-DD HH24:MI'),
 		 	3
 		 )
 		 
 	</insert>
 		
 	<!-- 프로젝트 상세 조회 -->
 	<select id="projectDetail" parameterType="int" resultType="com.web.youneeds.dto.ProjectDto">
 		select
 			 p_id, 
		 	 p_title, 
		 	 p_category, 
		 	 target_amount, 
		 	 p_regdate, 
		 	 start_date,  
		 	 end_date, 
		 	 creator_uid
 		from project 
 		where p_id = #{p_id}
 	</select>
 	
 	
 	
 	<select id="creatorMyPageInfo" parameterType="java.util.HashMap" resultType="projectDto">
    SELECT P_ID, P_TITLE, P_CATEGORY, TARGET_AMOUNT, P_REGDATE, START_DATE, END_DATE
    FROM ( SELECT ROW_NUMBER() OVER(ORDER BY P_ID) AS NUM, P_ID, P_TITLE, P_CATEGORY, TARGET_AMOUNT, P_REGDATE, START_DATE, END_DATE, CREATOR_UID FROM PROJECT )
    WHERE CREATOR_UID = #{m_uid} AND  NUM <![CDATA[<=]]> #{page_val}*3 AND NUM <![CDATA[>=]]> #{page_val}*3-2
	</select>

	<select id="selectListMaxLength" resultType="int">
	SELECT MAX(ROWNUM) FROM PROJECT WHERE CREATOR_UID=#{m_uid} ORDER BY P_ID DESC
	</select>
	
	
 </mapper>